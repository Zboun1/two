<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="css/index.css">
	</head>
	<body>
		<div class="header">
			<div><textarea placeholder="有什么新鲜事想分享给大家？" id="pla";></textarea></div>
			<div class="header-foot">
				<span>😀</span>
				<span>🎞</span>
				<span>🥚</span>
				<span>🥝</span>
				<span>📺</span>
				<span>⚡</span>
				<span>⚙</span>
				<div class="header-foot-right">
					<span id="input-num">0</span>
					<span>公开</span>
					<button id="send">发送</button>
				</div>
			</div>
			
		</div>
		<div id="container">
			<div class="cbody">
				<div class="cbody-left">
					<a href=""><img src="img/icon.jpg"/></a>
				</div>
				<div class="cbody-right">
					<div class="cbody-right-top">
						<h3>每日经济新闻</h3>
						<p><span>32分钟前</span> 来自 微博 weibo.com</p>
					</div>
					<div class="cbody-right-bottom">
						每经16点丨佳能中国推出笑脸识别门禁：愁眉苦脸不开门】作为应对新冠疫情的对策，佳能中国公司20日发布了在进入办公室和会议室之际，认证员工“笑脸”的IT系统，该系统还能同时测体温。佳能希望，该系统有助于在容易因疫情变得阴暗的公司内创造良好氛围。员工和访客需面向设在前台等处的
					</div>
				</div>
				<div class="cbody-nav">
					<div>﹀</div>
					<ul>
						<li class="editor">编辑</li>
						<li>收藏</li>
						<li class="delete">删除</li>
						<li>投诉</li>
						<li>赋值微博地址</li>
					</ul>
				</div>
			</div>
		</div>

		<div class="popup-editor" id="popup-editor">
			<div class="editor-content" id="editor-content">
				<h3>修改博文</h3>
				<textarea name="" rows="" cols="" id="editor-input"></textarea>
				<div>
					<button id="editor-save">保存</button>
                	<button id="editor-close">关闭</button>
				</div>
			</div>
		</div>
		<div class="popup-delete" id="popup-delete">
			<div class="delete-content" id="delete-content">
				<h3>删除博文</h3>
				<button id="delete-save">保存</button>
				<button id="delete-close">关闭</button>
			</div>
		</div>
		
		
		<script type="text/javascript">
				var pla = document.getElementById("pla");

				var inputNum = document.getElementById("input-num")

				var send = document.getElementById("send")

				var cbody = document.getElementsByClassName("cbody")[0]

				var container = document.getElementById("container")

				var cbodyEditor = document.getElementsByClassName("editor")
				var cbodyDelete = document.getElementsByClassName("delete")

				var popupEditor = document.getElementById("popup-editor")
				var popupDelete = document.getElementById("popup-delete")

				var editorInput = document.getElementById("editor-input");
				var editorSave = document.getElementById("editor-save");
				var editorClose = document.getElementById("editor-close");
				var deleteSave = document.getElementById("delete-save");
				var deleteClose = document.getElementById("delete-close");

				var editorContent = document.getElementById("editor-content");
				var deleteContent = document.getElementById("delete-content");
				
				var del = null;

				var isDown = false;
				
				pla.onfocus = function(){
					pla.style.background = "white"
				}
				pla.onblur = function(){
					pla.style.background = "rgba(128, 128, 128, 0.2)"
				}
				
				pla.oninput = function(){
					inputNum.innerText = pla.value.length;
					
					if(pla.value){
						send.style.background = "orange"
						send.style.cursor = "pointer"
					}else{
						send.style.cursor = "not-allowed"
						send.style.background = "#FFC180"
					}
				}
				
				send.onclick = function(){
					var inputValue = pla.value
					if(inputValue == 0){
						return
					}
					send.style.cursor = "not-allowed"
					send.style.background = "#FFC180"
					inputNum.innerText = 0;
					
					var newbody = cbody.cloneNode(true)

					newbody.getElementsByClassName("cbody-right-bottom")[0].innerText = inputValue
					
					container.appendChild(newbody)
					pla.value = ""
					bindEditorEvent(container.getElementsByClassName("editor"))
					bindDeleteEvent(container.getElementsByClassName("delete"))
				}
				
				function bindEditorEvent(domList){
					for(var i = 0;i < domList.length;i++){
						domList[i].onclick = function(){
							popupEditor.style.display = "block"
							del = this.parentNode.parentNode
							editorInput.value = del.parentNode.getElementsByClassName("cbody-right-bottom")[0].innerText
						}
					}
				}
				bindEditorEvent(container.getElementsByClassName("editor"))


				function bindDeleteEvent(domList){
					for(var i = 0;i < domList.length;i++){
						domList[i].onclick = function(){
							popupDelete.style.display = "block"
							del = this.parentNode.parentNode
						}
					}
				}
				bindDeleteEvent(container.getElementsByClassName("delete"))

				editorSave.onclick = function(){
					del.parentNode.getElementsByClassName("cbody-right-bottom")[0].innerText = editorInput.value
					popupEditor.style.display = "none"
				}
				editorClose.onclick = function(){
					popupEditor.style.display = "none"
				}
				deleteSave.onclick = function(){
					del.parentNode.remove()
					popupDelete.style.display = "none"
				}
				
				deleteClose.onclick = function(){
					popupDelete.style.display = "none"
				}

				//跟随鼠标移动
				popupEditor.onmousedown = function(){
					isDown = true
				}
				popupEditor.onmouseup = function(){
					isDown = false
				}

				popupEditor.onmousemove = function(event){
					if(!isDown){
						return
					}
					var x = event.clientX;
					var y = event.clientY;

					editorContent.style.left = x - editorContent.offsetWidth/2 + "px";
					editorContent.style.top = y  + "px";
					
				}

				popupDelete.onmousedown = function(){
					isDown = true
				}
				popupDelete.onmouseup = function(){
					isDown = false
				}

				popupDelete.onmousemove = function(event){
					if(!isDown){
						return
					}
					var x = event.clientX;
					var y = event.clientY;

					deleteContent.style.left = x - deleteContent.offsetWidth/2 + "px";
					deleteContent.style.top = y  + "px";
					
				}

			</script>
	</body>
</html>
